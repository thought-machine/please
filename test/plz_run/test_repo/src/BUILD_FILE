sh_binary(
    name = "env_printer",
    data = [
        "wibble.txt",
        ":wibble",
    ],
    main = "env_printer.sh",
)

sh_cmd(
    name = "wibble",
    cmd = "echo wibble",
)

sh_cmd(
    name = "wobble",
    cmd = "sleep 0.1 && echo wobble",
)

## Test add_data functionality
#build_rule(
#    name = "_add_data_gen",
##    deps = [":temp"],
#    test = True,
#    test_cmd = "echo $DATA > $OUT",
#    outs = ["_add_data_gen.txt"],
#    pre_build = lambda name: add_data(name, ":temp"),
#)
#
#genrule(
#    name = "temp",
#    cmd = "touch $OUT",
#    outs = ["foo.temp"],
#)

# Test add_data functionality
build_rule(
    name = "_add_data_rule",
    test = True,
    no_test_output = True,
    test_cmd = "if [ $DATA != $PKG_DIR/dummydata.txt ]; then exit 1; else exit 0; fi;",
    pre_build = lambda name: add_data(name, "dummydata.txt"),
)
